# Структура проекта StoryCraft AI

## Основные файлы документации

- [README.md](./README.md) - Основная документация
- [ALGORITHM.md](./ALGORITHM.md) - Описание алгоритма работы
- [PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md) - Структура проекта (этот файл)

## Структура проекта

```
comfyuigen/
├── app/                            # Основное приложение
│   ├── api/                        # API endpoints
│   │   └── routes/
│   │       └── story.py           # Маршруты для работы с историями
│   └── services/                   # Сервисы уровня приложения
│       ├── ollama/                 # Генерация историй
│       │   ├── story_generator.py  # Основной генератор сюжета
│       │   └── story_context.py    # Контекст и состояние истории
│       └── comfy/                  # Генерация изображений
│           └── image_generator.py  # Генератор изображений для историй
│
├── config/                         # Конфигурационные файлы
│   ├── ollama_config.py           # Параметры Ollama API
│   └── comfy_config.py            # Параметры ComfyUI
│
├── docs/                          # Документация проекта
│   └── ollama_api_howto.md       # Руководство по работе с Ollama API
│
├── services/                       # Базовые сервисы
│   ├── ollama_connection.py       # Низкоуровневое подключение к Ollama
│   └── ollama_service.py          # Высокоуровневый сервис Ollama
│
├── static/                        # Статические файлы
│   └── js/
│       └── main.js               # Клиентский JavaScript
│
├── templates/                     # HTML шаблоны
│   └── book.html                 # Основной интерфейс новеллы
│
├── tests/                        # Тесты
│   └── test_comfy_config.py     # Тесты конфигурации ComfyUI
│
└── requirements/                 # Зависимости проекта
    ├── base.txt                 # Базовые зависимости
    ├── dev.txt                  # Зависимости для разработки
    └── prod.txt                 # Зависимости для продакшена
```

## Документация API

- [ollama_api_howto.md](./docs/ollama_api_howto.md) - Руководство по работе с Ollama API

## Описание компонентов

### Уровни сервисов

Проект использует трехуровневую архитектуру сервисов:

1. **Базовые сервисы** (`/services/`)
   - Низкоуровневое взаимодействие с внешними API
   - Управление соединениями и базовая обработка ошибок
   - Файлы:
     * `ollama_connection.py` - асинхронное подключение к Ollama API
     * `ollama_service.py` - базовые операции с Ollama API

2. **Конфигурация** (`/config/`)
   - Настройки внешних сервисов и API
   - Параметры для генерации контента
   - Файлы:
     * `ollama_config.py` - конфигурация Ollama (модель, параметры генерации)
     * `comfy_config.py` - конфигурация ComfyUI (воркфлоу, параметры изображений)

3. **Сервисы приложения** (`/app/services/`)
   - Бизнес-логика приложения
   - Специфичные для приложения операции
   - Компоненты:
     * `ollama/story_generator.py` - генерация сюжета
     * `ollama/story_context.py` - управление контекстом истории
     * `comfy/image_generator.py` - создание иллюстраций

### API и маршрутизация

- **API endpoints** (`/app/api/routes/`)
  - `story.py` - обработка запросов для генерации историй
  - Асинхронные маршруты FastAPI

### Веб-интерфейс

- **Шаблоны** (`/templates/`)
  - `book.html` - основной интерфейс визуальной новеллы

- **Статические файлы** (`/static/`)
  - `js/main.js` - клиентская логика и взаимодействие с API

### Тестирование

- **Тесты** (`/tests/`)
  - Модульные тесты конфигурации и сервисов
  - Файлы:
    * `test_comfy_config.py` - тесты настроек ComfyUI

### Зависимости

- **Requirements** (`/requirements/`)
  - `base.txt` - основные зависимости
  - `dev.txt` - инструменты разработки
  - `prod.txt` - продакшен зависимости
